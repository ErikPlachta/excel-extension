<app-section
  class="sso-home"
  title="Authentication"
  subtitle="Sign in with JWT authentication (mock implementation for development)."
>
  <div *ngIf="!isSignedIn; else signedIn">
    <!-- JWT Sign-in Form -->
    <app-card title="Sign In with JWT" variant="default">
      <form class="sign-in-form" (ngSubmit)="signInWithJwt()">
        <div class="form-group">
          <label for="email">Email</label>
          <input
            type="email"
            id="email"
            [(ngModel)]="email"
            name="email"
            placeholder="user@example.com"
            [disabled]="isLoading"
          />
        </div>

        <div class="form-group">
          <label for="password">Password</label>
          <input
            type="password"
            id="password"
            [(ngModel)]="password"
            name="password"
            placeholder="(any value - mock)"
            [disabled]="isLoading"
          />
        </div>

        <div class="form-group">
          <label for="role">Role</label>
          <select
            id="role"
            [(ngModel)]="selectedRole"
            name="role"
            [disabled]="isLoading"
          >
            <option value="analyst">Analyst</option>
            <option value="admin">Admin</option>
          </select>
        </div>

        <div *ngIf="signInError" class="error-message">
          {{ signInError }}
        </div>

        <div class="form-actions">
          <button type="submit" [disabled]="isLoading" class="btn-primary">
            {{ isLoading ? 'Signing in...' : 'Sign In' }}
          </button>
        </div>
      </form>

      <!-- Quick sign-in buttons (dev mode only) -->
      <div *ngIf="isDevModeActive && quickSignInUsers.length > 0" class="quick-sign-in">
        <span class="divider-text">or quick sign-in</span>
        <div class="quick-sign-in-buttons">
          <button
            *ngFor="let user of quickSignInUsers"
            type="button"
            (click)="signInAs(user)"
            [disabled]="isLoading"
            class="btn-secondary"
          >
            {{ user.label }}
          </button>
        </div>
      </div>
    </app-card>
  </div>

  <ng-template #signedIn>
    <app-card title="Signed-in User" variant="emphasis">
      <p><strong>User:</strong> {{ userName }}</p>
      <p><strong>Email:</strong> {{ userEmail }}</p>
      <p><strong>Token:</strong> {{ tokenSnippet }}</p>
      <p><strong>Role:</strong> {{ roleSummary }}</p>
      <p *ngIf="tokenExpiryDisplay">
        <strong>Token expires in:</strong>
        <span [class.expiring-soon]="isTokenExpiringSoon">
          {{ tokenExpiryDisplay }}
        </span>
        <span *ngIf="isTokenExpiringSoon" class="refresh-hint">
          (auto-refresh scheduled)
        </span>
      </p>

      <div class="form-actions">
        <button type="button" (click)="signOut()" class="btn-secondary">
          Sign Out
        </button>
      </div>
    </app-card>
  </ng-template>
</app-section>
